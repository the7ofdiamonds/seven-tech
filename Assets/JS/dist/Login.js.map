{"version":3,"file":"Login.js","sources":["../../../src/controllers/loginSlice.js","../../../src/views/Login.jsx"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport {\n    browserSessionPersistence,\n    setPersistence,\n    signInWithEmailAndPassword,\n    getAuth,\n} from 'firebase/auth';\n\nimport { firebaseAuth } from '../services/firebase/config.js';\n\nconst initialState = {\n    loginLoading: false,\n    loginError: '',\n    user_login: '',\n    user_pass: '',\n    user_email: '',\n    first_name: '',\n    last_name: '',\n    user_id: ''\n};\n\n// Use php in the backend\n\nexport const signInEmailAndPassword = createAsyncThunk('login/signInEmailAndPassword', async (credentials) => {\n    try {\n        const auth = getAuth();\n        const Email = credentials.email;\n        const Password = credentials.password;\n\n        await signInWithEmailAndPassword(auth, Email, Password);\n        setPersistence(auth, browserSessionPersistence);\n\n        const user = firebaseAuth.currentUser;\n\n        if (!user) {\n            throw new Error('User not found.', 404);\n        }\n\n        sessionStorage.setItem('email', Email);\n\n        const token = await user.getIdToken();\n        const data = { idToken: token, user_password: Password };\n\n        const response = await fetch('/wp-json/seven-tech/v1/users/login', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(data)\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json();\n            const errorMessage = errorData.message;\n            throw new Error(errorMessage);\n        }\n\n        const responseData = await response.json();\n        return responseData;\n    } catch (error) {\n        console.error(error)\n        throw error;\n    }\n});\n\nexport const loginSlice = createSlice({\n    name: 'login',\n    initialState,\n    extraReducers: (builder) => {\n        builder\n            .addCase(signInEmailAndPassword.fulfilled, (state, action) => {\n                state.loginLoading = false;\n                state.loginError = '';\n                state.loginMessage = action.payload;\n            })\n            .addMatcher(isAnyOf(\n                signInEmailAndPassword.pending,\n            ), (state) => {\n                state.loginLoading = true;\n                state.loginError = null;\n            })\n            .addMatcher(isAnyOf(\n                signInEmailAndPassword.rejected,\n            ),\n                (state, action) => {\n                    state.loginLoading = false;\n                    state.loginError = action.error.message;\n                });\n    }\n})\n\nexport default loginSlice;","import { useState } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport NavigationComponent from './components/NavigationLogin';\n\nimport { displayStatus, displayStatusType } from '../utils/DisplayStatus';\n\nimport { signInEmailAndPassword } from '../controllers/loginSlice';\n\nfunction LoginComponent() {\n  const [formData, setFormData] = useState({ email: '', password: '' });\n  const [messageType, setMessageType] = useState('');\n  const [message, setMessage] = useState(\n    'Enter your email and password to log in.'\n  );\n\n  const dispatch = useDispatch();\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    setFormData({\n      ...formData,\n      [name]: value,\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    dispatch(signInEmailAndPassword(formData))\n    .then((response) => {\n      console.log(response);\n      setMessage(displayStatus(response));\n      setMessageType(displayStatusType(response));\n    })\n    .then(() => {\n      const urlParams = new URLSearchParams(window.location.search);\n      const redirectTo = urlParams.get('redirectTo');\n\n      setTimeout(() => {\n        if (redirectTo === null) {\n          window.location.href = '/dashboard';\n        } else {\n          window.location.href = redirectTo;\n        }\n      }, 5000);\n    });\n  };\n\n  return (\n    <>\n      <main className=\"login\">\n        <NavigationComponent />\n\n        <div className=\"login card\">\n          <form onSubmit={handleSubmit}>\n            <table>\n              <thead></thead>\n              <tbody>\n                <tr>\n                  <td>\n                    <input\n                      type=\"email\"\n                      name=\"email\"\n                      placeholder=\"Email\"\n                      value={formData.email}\n                      onChange={handleInputChange}\n                      required\n                    />\n                  </td>\n                </tr>\n                <tr>\n                  <td>\n                    <input\n                      type=\"password\"\n                      name=\"password\"\n                      placeholder=\"Password\"\n                      value={formData.password}\n                      onChange={handleInputChange}\n                      required\n                    />\n                  </td>\n                </tr>\n              </tbody>\n              <tfoot>\n                <tr>\n                  <td>\n                    <button type=\"submit\">\n                      <h3>LOGIN</h3>\n                    </button>\n                  </td>\n                </tr>\n              </tfoot>\n            </table>\n          </form>\n        </div>\n\n        {message !== '' && (\n          <div className={`status-bar card ${messageType}`}>\n            <span>{message}</span>\n          </div>\n        )}\n      </main>\n    </>\n  );\n}\n\nexport default LoginComponent;\n"],"names":["initialState","loginLoading","loginError","user_login","user_pass","user_email","first_name","last_name","user_id","signInEmailAndPassword","createAsyncThunk","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","credentials","auth","Email","Password","user","token","data","response","errorData","errorMessage","responseData","wrap","_context","prev","next","getAuth","email","password","signInWithEmailAndPassword","setPersistence","browserSessionPersistence","firebaseAuth","currentUser","Error","sessionStorage","setItem","getIdToken","sent","idToken","user_password","fetch","method","headers","body","JSON","stringify","ok","json","message","abrupt","t0","console","error","stop","_x","apply","arguments","createSlice","name","extraReducers","builder","addCase","fulfilled","state","action","loginMessage","payload","addMatcher","isAnyOf","pending","rejected","LoginComponent","_useState","useState","_useState2","_slicedToArray","formData","setFormData","_useState3","_useState4","messageType","setMessageType","_useState5","_useState6","setMessage","dispatch","useDispatch","handleInputChange","e","_e$target","target","value","_objectSpread","_defineProperty","handleSubmit","preventDefault","then","log","displayStatus","displayStatusType","urlParams","URLSearchParams","window","location","search","redirectTo","get","setTimeout","href","jsx","Fragment","children","jsxs","className","NavigationComponent","onSubmit","type","placeholder","onChange","required","concat"],"mappings":"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"}