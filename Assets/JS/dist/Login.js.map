{"version":3,"file":"Login.js","sources":["../../../src/controllers/loginSlice.js","../../../src/views/Login.jsx"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport {\n    browserSessionPersistence,\n    setPersistence,\n    signInWithEmailAndPassword,\n    getAuth,\n} from 'firebase/auth';\n\nimport { firebaseAuth } from '../services/firebase/config.js';\n\nconst initialState = {\n    loginLoading: false,\n    loginError: '',\n    user_login: '',\n    user_pass: '',\n    user_email: '',\n    first_name: '',\n    last_name: '',\n    user_id: ''\n};\n\n// Use php in the backend\n\nexport const signInEmailAndPassword = createAsyncThunk('login/signInEmailAndPassword', async (credentials) => {\n    try {\n        const auth = getAuth();\n        const Email = credentials.email;\n        const Password = credentials.password;\n\n        await signInWithEmailAndPassword(auth, Email, Password);\n        setPersistence(auth, browserSessionPersistence);\n\n        const user = firebaseAuth.currentUser;\n\n        if (!user) {\n            throw new Error('User not found.', 404);\n        }\n\n        sessionStorage.setItem('email', Email);\n\n        const token = await user.getIdToken();\n        const data = { idToken: token, user_password: Password };\n\n        const response = await fetch('/wp-json/seven-tech/v1/users/login', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(data)\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json();\n            const errorMessage = errorData.message;\n            throw new Error(errorMessage);\n        }\n\n        const responseData = await response.json();\n        return responseData;\n    } catch (error) {\n        console.error(error)\n        throw error;\n    }\n});\n\nexport const loginSlice = createSlice({\n    name: 'login',\n    initialState,\n    extraReducers: (builder) => {\n        builder\n            .addCase(signInEmailAndPassword.fulfilled, (state, action) => {\n                state.loginLoading = false;\n                state.loginError = '';\n                state.loginMessage = action.payload;\n            })\n            .addMatcher(isAnyOf(\n                signInEmailAndPassword.pending,\n            ), (state) => {\n                state.loginLoading = true;\n                state.loginError = null;\n            })\n            .addMatcher(isAnyOf(\n                signInEmailAndPassword.rejected,\n            ),\n                (state, action) => {\n                    state.loginLoading = false;\n                    state.loginError = action.error.message;\n                });\n    }\n})\n\nexport default loginSlice;","import { useState } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport NavigationComponent from './components/NavigationLogin';\n\nimport { displayStatus, displayStatusType } from '../utils/DisplayStatus';\n\nimport { signInEmailAndPassword } from '../controllers/loginSlice';\n\nfunction LoginComponent() {\n  const [formData, setFormData] = useState({ email: '', password: '' });\n  const [messageType, setMessageType] = useState('');\n  const [message, setMessage] = useState(\n    'Enter your email and password to log in.'\n  );\n\n  const dispatch = useDispatch();\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    setFormData({\n      ...formData,\n      [name]: value,\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    dispatch(signInEmailAndPassword(formData))\n    .then((response) => {\n      console.log(response);\n      setMessage(displayStatus(response));\n      setMessageType(displayStatusType(response));\n    })\n    .then(() => {\n      const urlParams = new URLSearchParams(window.location.search);\n      const redirectTo = urlParams.get('redirectTo');\n\n      setTimeout(() => {\n        if (redirectTo === null) {\n          window.location.href = '/dashboard';\n        } else {\n          window.location.href = redirectTo;\n        }\n      }, 5000);\n    });\n  };\n\n  return (\n    <>\n      <main className=\"login\">\n        <NavigationComponent />\n\n        <div className=\"login card\">\n          <form onSubmit={handleSubmit}>\n            <table>\n              <thead></thead>\n              <tbody>\n                <tr>\n                  <td>\n                    <input\n                      type=\"email\"\n                      name=\"email\"\n                      placeholder=\"Email\"\n                      value={formData.email}\n                      onChange={handleInputChange}\n                      required\n                    />\n                  </td>\n                </tr>\n                <tr>\n                  <td>\n                    <input\n                      type=\"password\"\n                      name=\"password\"\n                      placeholder=\"Password\"\n                      value={formData.password}\n                      onChange={handleInputChange}\n                      required\n                    />\n                  </td>\n                </tr>\n              </tbody>\n              <tfoot>\n                <tr>\n                  <td>\n                    <button type=\"submit\">\n                      <h3>LOGIN</h3>\n                    </button>\n                  </td>\n                </tr>\n              </tfoot>\n            </table>\n          </form>\n        </div>\n\n        {message !== '' && (\n          <div className={`status-bar card ${messageType}`}>\n            <span>{message}</span>\n          </div>\n        )}\n      </main>\n    </>\n  );\n}\n\nexport default LoginComponent;\n"],"names":["initialState","signInEmailAndPassword","createAsyncThunk","credentials","auth","getAuth","Email","Password","signInWithEmailAndPassword","setPersistence","browserSessionPersistence","user","firebaseAuth","data","response","errorMessage","error","createSlice","builder","state","action","LoginComponent","formData","setFormData","useState","messageType","setMessageType","message","setMessage","dispatch","useDispatch","handleInputChange","e","name","value","handleSubmit","displayStatus","displayStatusType","redirectTo","jsx","Fragment","jsxs","NavigationComponent"],"mappings":"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"}