import{c as C,a as I,_ as A,b as S,s as L,f as N,d as D,e as M,h as _,r as b,i as x,j as a,k,l as O}from"./index.js";import{N as R}from"./NavigationLogin.js";import{d as U,a as $}from"./DisplayStatus.js";import{u as q}from"./useDispatch.js";var F={loginLoading:!1,loginError:"",user_login:"",user_pass:"",user_email:"",first_name:"",last_name:"",user_id:""},v=C("login/signInEmailAndPassword",function(){var m=A(S().mark(function n(r){var s,o,i,l,p,g,t,u,f,w;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=D(),o=r.email,i=r.password,e.next=6,M(s,o,i);case 6:if(L(s,_),l=N.currentUser,l){e.next=10;break}throw new Error("User not found.",404);case 10:return sessionStorage.setItem("email",o),e.next=13,l.getIdToken();case 13:return p=e.sent,g={idToken:p,user_password:i},e.next=17,fetch("/wp-json/seven-tech/v1/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});case 17:if(t=e.sent,t.ok){e.next=24;break}return e.next=21,t.json();case 21:throw u=e.sent,f=u.message,new Error(f);case 24:return e.next=26,t.json();case 26:return w=e.sent,e.abrupt("return",w);case 30:throw e.prev=30,e.t0=e.catch(0),console.error(e.t0),e.t0;case 34:case"end":return e.stop()}},n,null,[[0,30]])}));return function(n){return m.apply(this,arguments)}}());I({name:"login",initialState:F,extraReducers:function(n){n.addCase(v.fulfilled,function(r,s){r.loginLoading=!1,r.loginError="",r.loginMessage=s.payload}).addMatcher(isAnyOf(v.pending),function(r){r.loginLoading=!0,r.loginError=null}).addMatcher(isAnyOf(v.rejected),function(r,s){r.loginLoading=!1,r.loginError=s.error.message})}});function B(){var m=b.useState({email:"",password:""}),n=x(m,2),r=n[0],s=n[1],o=b.useState(""),i=x(o,2),l=i[0],p=i[1],g=b.useState("Enter your email and password to log in."),t=x(g,2),u=t[0],f=t[1],w=q(),y=function(j){var d=j.target,T=d.name,c=d.value;s(k(k({},r),{},O({},T,c)))},e=function(){var E=A(S().mark(function j(d){return S().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d.preventDefault(),w(v(r)).then(function(h){console.log(h),f(U(h)),p($(h))}).then(function(){var h=new URLSearchParams(window.location.search),P=h.get("redirectTo");setTimeout(function(){P===null?window.location.href="/dashboard":window.location.href=P},5e3)});case 2:case"end":return c.stop()}},j)}));return function(d){return E.apply(this,arguments)}}();return a.jsx(a.Fragment,{children:a.jsxs("main",{className:"login",children:[a.jsx(R,{}),a.jsx("div",{className:"login card",children:a.jsx("form",{onSubmit:e,children:a.jsxs("table",{children:[a.jsx("thead",{}),a.jsxs("tbody",{children:[a.jsx("tr",{children:a.jsx("td",{children:a.jsx("input",{type:"email",name:"email",placeholder:"Email",value:r.email,onChange:y,required:!0})})}),a.jsx("tr",{children:a.jsx("td",{children:a.jsx("input",{type:"password",name:"password",placeholder:"Password",value:r.password,onChange:y,required:!0})})})]}),a.jsx("tfoot",{children:a.jsx("tr",{children:a.jsx("td",{children:a.jsx("button",{type:"submit",children:a.jsx("h3",{children:"LOGIN"})})})})})]})})}),u!==""&&a.jsx("div",{className:"status-bar card ".concat(l),children:a.jsx("span",{children:u})})]})})}export{B as default};
//# sourceMappingURL=Login.js.map
